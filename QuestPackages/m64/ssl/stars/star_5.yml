variables:
  s5:
    star_loc:             -927;63;341;marocraft
    star_loc_xyz:         -927 63 341
    eye1_loc:             -931;61;343;marocraft
    eye2_loc:             -923;61;342;marocraft
    boss1_loc:            -931 61 343
    boss2_loc:            -923 61 342
    bea_block_loc:        -892;83;-77;marocraft


### STAR 5 - STAND TALL ON THE FOUR PILLARS
events:
  # Init
  init_s5:                "folder e_s5_add_obj_pillars"
  e_s5_add_obj_pillars:   "folder e_obj_add_s5_p1,e_obj_add_s5_p2,e_obj_add_s5_p3,e_obj_add_s5_p4"
  e_obj_add_s5_p1:        "objective add o_s5_p1"
  e_obj_add_s5_p2:        "objective add o_s5_p2"
  e_obj_add_s5_p3:        "objective add o_s5_p3"
  e_obj_add_s5_p4:        "objective add o_s5_p4"

  # Pillar 1
  e_s5_pillar_1:          "folder core-sfx.e_coin,e_s5_tag_add_p1,if_all_pillars_s5"
  e_s5_tag_add_p1:        "tag add s5_p1"
  # Pillar 2
  e_s5_pillar_2:          "folder core-sfx.e_coin,e_s5_tag_add_p2,if_all_pillars_s5"
  e_s5_tag_add_p2:        "tag add s5_p2"
  # Pillar 3
  e_s5_pillar_3:          "folder core-sfx.e_coin,e_s5_tag_add_p3,if_all_pillars_s5"
  e_s5_tag_add_p3:        "tag add s5_p3"
  # Pillar 4
  e_s5_pillar_4:          "folder core-sfx.e_coin,e_s5_tag_add_p4,if_all_pillars_s5"
  e_s5_tag_add_p4:        "tag add s5_p4"

  # Check all pillars
  if_all_pillars_s5:      "if chk_s5_p_all e_s5_all_pillars else core-main.e_dummy"
  e_s5_all_pillars:       "folder core-sfx.e_correct,e_s5_show_beacon,e_s5_tag_add_unlock,e_obj_add_s5_tp_top"
  e_s5_show_beacon:       "setblock AIR $s5.bea_block_loc$"
  e_s5_tag_add_unlock:    "tag add s5_open"
  e_obj_add_s5_tp_top:    "objective add o_s5_tp_pyr_top"

  e_s5_tp_pyr_top:        "folder e_s5_tp_in_top,e_s5_hide_beacon,e_obj_add_s5_ent_boss,e_play_music_pyr"
  e_s5_tp_in_top:         "teleport $inside_pyramid_top$"
  e_obj_add_s5_ent_boss:  "objective add o_s5_enter_boss"
  
  # Init boss (Boss 1_1)
  e_s5_sfx_explotion:     "notify io:sound sound:entity.generic.explode soundvolume:$core-sfx.svol$"
  e_s5_die_boss_1:        "folder e_s5_ptc_explotion_b1,e_s5_sfx_explotion"
  e_s5_ptc_explotion_b1:  "command execute in minecraft:overworld at %player% run particle minecraft:explosion $s5.boss1_loc$ 0.5 0 0.5 1 3"
  e_s5_die_boss_2:        "folder e_s5_ptc_explotion_b2,e_s5_sfx_explotion"
  e_s5_ptc_explotion_b2:  "command execute in minecraft:overworld at %player% run particle minecraft:explosion $s5.boss2_loc$ 0.5 0 0.5 1 3"
  
  e_s5_init_boss:         "folder e_obj_add_s5_boss_1_1,e_play_music_boss"
  e_obj_add_s5_boss_1_1:  "objective add o_s5_boss_1_1"

  # Boss 2_1
  e_s5_hit_boss_1_1:      "folder e_obj_add_s5_boss_2_1,core-sfx.e_whomp"
  e_obj_add_s5_boss_2_1:  "objective add o_s5_boss_2_1"

  # Boss 1_2
  e_s5_hit_boss_2_1:      "folder e_obj_add_s5_boss_1_2,core-sfx.e_whomp"
  e_obj_add_s5_boss_1_2:  "objective add o_s5_boss_1_2"

  # Boss 2_2
  e_s5_hit_boss_1_2:      "folder e_obj_add_s5_boss_2_2,core-sfx.e_whomp"
  e_obj_add_s5_boss_2_2:  "objective add o_s5_boss_2_2"

  # Boss 3_1
  e_s5_hit_boss_2_2:      "folder e_obj_add_s5_boss_1_3,core-sfx.e_whomp"
  e_obj_add_s5_boss_1_3:  "objective add o_s5_boss_1_3"

  # Boss 3_2 - (b1 dead)
  e_s5_hit_boss_1_3:      "folder e_obj_add_s5_boss_2_3,core-sfx.e_whomp,e_s5_die_boss_1"
  e_obj_add_s5_boss_2_3:  "objective add o_s5_boss_2_3"

  # Boss 2 dead
  e_s5_hit_boss_2_3:      "folder core-sfx.e_whomp,e_s5_die_boss_2,e_s5_notif,e_s5_boss_defeated"
  e_s5_notif:             "notify yay"

  # Spawn star
  e_s5_boss_defeated:     "folder e_s5_spawn_star,e_s5_summon_firework,core-sfx.e_star_spawn,e_s5_notif_spawn_star,e_obj_add_s5_star,e_s5_gp_add_star,e_s5_tag_add_spawned"
  e_s5_spawn_star:        "setblock RAW_GOLD_BLOCK $s5.star_loc$"
  e_s5_summon_firework:   "command execute in minecraft:overworld run summon firework_rocket $s5.star_loc_xyz$ {LifeTime:10,Motion:[0d,1d,0d],shotAtAngle:1b,FireworksItem:{id:firework_rocket,Count:1,tag:{Fireworks:{Flight:20,Explosions:[{Type:1,Flicker:1b,Colors:[I;14602026]},{Colors:[I;11743532]},{Colors:[I;4312372]}]}}}}"
  e_s5_notif_spawn_star:  "notify &3A star has spawned! io:title"
  e_obj_add_s5_star:      "objective add o_s5_star"
  e_s5_gp_add_star:       "globalpoint ssl_s5 1 action:add"
  e_s5_tag_add_spawned:   "tag add s5_spawned"

  # Win
  win_s5:                 "folder e_notif_s5_win,core-sfx.e_got_star,deit_s5,if_firstwin_s5"
  e_notif_s5_win:         "notify &3Stand tall on the four pillars\n&2Cleared! io:title"

  # First win
  if_firstwin_s5:         "if !chk_s5_obtained firstwin_s5 else core-main.e_dummy"
  firstwin_s5:            "folder e_broad_s5_first,tag_add_s5_win,e_stop_music,exit_star"
  e_broad_s5_first:       "command broadcast &6%player% &2got a star: [SSL] Stand tall on the four pillars"
  tag_add_s5_win:         "tag add s5"

  # Cleanup
  deit_s5:                "folder e_s5_del_obj_pillars,e_s5_hide_beacon,e_s5_del_tags,e_obj_del_s5_boss,if_s5_spawned,e_s5_tag_del_spawned"
  e_s5_del_obj_pillars:   "folder e_obj_del_s5_p1,e_obj_del_s5_p2,e_obj_del_s5_p3,e_obj_del_s5_p4"
  e_obj_del_s5_p1:        "objective remove o_s5_p1"
  e_obj_del_s5_p2:        "objective remove o_s5_p2"
  e_obj_del_s5_p3:        "objective remove o_s5_p3"
  e_obj_del_s5_p4:        "objective remove o_s5_p4"
  e_s5_hide_beacon:       "setblock BLACK_CONCRETE $s5.bea_block_loc$"
  e_s5_del_tags:          "run ^tag delete s5_p1 ^tag delete s5_p2 ^tag delete s5_p3 ^tag delete s5_p4 ^tag delete s5_open"
  e_obj_del_s5_boss:      "folder e_obj_del_s5_boss_1_1,e_obj_del_s5_boss_2_1,e_obj_del_s5_boss_1_2,e_obj_del_s5_boss_2_2,e_obj_del_s5_boss_1_3,e_obj_del_s5_boss_2_3"
  e_obj_del_s5_boss_1_1:  "objective remove o_s5_boss_1_1"
  e_obj_del_s5_boss_2_1:  "objective remove o_s5_boss_2_1"
  e_obj_del_s5_boss_1_2:  "objective remove o_s5_boss_1_2"
  e_obj_del_s5_boss_2_2:  "objective remove o_s5_boss_2_2"
  e_obj_del_s5_boss_1_3:  "objective remove o_s5_boss_1_3"
  e_obj_del_s5_boss_2_3:  "objective remove o_s5_boss_2_3"

  if_s5_spawned:          "if chk_s5_spawned e_s5_del_spawned else core-main.e_dummy"
  e_s5_del_spawned:       "folder e_s5_gp_sub_star,if_s5_despawn"
  e_s5_gp_sub_star:       "globalpoint ssl_s5 1 action:subtract"

  if_s5_despawn:          "if !chk_s5_spawn_count e_s5_delete_star else core-main.e_dummy"
  e_s5_tag_del_spawned:   "tag delete s5_spawned"

  e_s5_delete_star:       "folder e_s5_despawn_star,e_s5_reset_star_count"
  e_s5_despawn_star:      "setblock AIR $s5.star_loc$"
  e_s5_reset_star_count:  "globalpoint ssl_s5 0 action:set"


conditions:
  chk_s5_obtained:        "tag s5"
  chk_s5_ontop_p_1:       "region ssl_s6_p1"
  chk_s5_ontop_p_2:       "region ssl_s6_p2"
  chk_s5_ontop_p_3:       "region ssl_s6_p3"
  chk_s5_ontop_p_4:       "region ssl_s6_p4"

  chk_s5_p_1:             "tag s5_p1"
  chk_s5_p_2:             "tag s5_p2"
  chk_s5_p_3:             "tag s5_p3"
  chk_s5_p_4:             "tag s5_p4"
  chk_s5_p_all:           "and chk_s5_p_1,chk_s5_p_2,chk_s5_p_3,chk_s5_p_4"

  chk_s5_open:            "tag s5_open"

  chk_s5_spawned:         "tag s5_spawned"
  chk_s5_spawn_count:     "globalpoint ssl_s5 1"


objectives:
  o_s5_star:              "action right any loc:$s5.star_loc$ events:win_s5"
  o_s5_p1:                "jump 1 conditions:chk_s5_ontop_p_1 events:e_s5_pillar_1"
  o_s5_p2:                "jump 1 conditions:chk_s5_ontop_p_2 events:e_s5_pillar_2"
  o_s5_p3:                "jump 1 conditions:chk_s5_ontop_p_3 events:e_s5_pillar_3"
  o_s5_p4:                "jump 1 conditions:chk_s5_ontop_p_4 events:e_s5_pillar_4"
  o_s5_tp_pyr_top:        "region enter_pyr_top enter conditions:chk_s5_open event:e_s5_tp_pyr_top"
  o_s5_enter_boss:        "region ssl_boss enter event:e_s5_init_boss"

  o_s5_boss_1_1:          "action right any loc:$s5.eye1_loc$ event:e_s5_hit_boss_1_1"
  o_s5_boss_2_1:          "action right any loc:$s5.eye2_loc$ event:e_s5_hit_boss_2_1"
  o_s5_boss_1_2:          "action right any loc:$s5.eye1_loc$ event:e_s5_hit_boss_1_2"
  o_s5_boss_2_2:          "action right any loc:$s5.eye2_loc$ event:e_s5_hit_boss_2_2"
  o_s5_boss_1_3:          "action right any loc:$s5.eye1_loc$ event:e_s5_hit_boss_1_3"
  o_s5_boss_2_3:          "action right any loc:$s5.eye2_loc$ event:e_s5_hit_boss_2_3"
