variables:
  s2:
    star_loc:             -453;38;677;marocraft
    star_loc_xyz:         -453 38 677
    push:
      xz_fr:  0.3
      xz_to:  0.6
      y_fr:   0.2
      y_to:   0.6
    int:                  # push interval
      fr: 10              # [ticks]
      to: 40              # [ticks]
    surv: 30              # seconds


### STAR 2 - CHILL WITH THE BULLY
events:
  # Init
  init_s2:                "folder e_obj_add_s2_enter,e_obj_add_s2_var"
  e_obj_add_s2_enter:     "objective add o_s2_enter"
  e_obj_add_s2_exit:      "objective add o_s2_exit"
  e_obj_add_s2_delay:     "objective add o_s2_delay_push"
  e_obj_add_s2_surv:      "objective add o_s2_delay_survive"
  e_obj_add_s2_var:       "objective add o_s2_variable"

  # Enter ice platform
  e_s2_enter:             "folder e_s2_notif_enter,e_obj_add_s2_exit,e_obj_add_s2_delay,e_obj_add_s2_surv"
  e_s2_notif_enter:       "notify &3Don't leave the platform\n&2For $s2.surv$ seconds io:title"

  # Exit ice platform (fail)
  e_s2_exit:              "folder e_s2_fail_remain,e_s2_notif_exit,deit_s2,init_s2"
  e_s2_fail_remain:       "variable o_s2_variable Remaining %math.calc:(objective.o_s2_delay_survive.rawSeconds)~1%"
  e_s2_notif_exit:        "notify &4You lost\n&4Remaining time &3%objective.o_s2_variable.Remaining% sec io:title"

  # Push
  e_s2_fol_push:          "folder e_s2_push,e_obj_add_s2_delay"
  e_s2_push:              "velocity vector:(%randomnumber.decimal.-$s2.push.xz_fr$~$s2.push.xz_to$%;%randomnumber.decimal.$s2.push.y_fr$~$s2.push.y_to$%;%randomnumber.decimal.-$s2.push.xz_fr$~$s2.push.xz_to$%) direction:absolute modification:set"

  # Check win
  e_s2_success:           "folder e_s2_stop,e_s2_spawn_star,e_s2_summon_firework,core-sfx.e_star_spawn,e_s2_notif_spawn_star,e_obj_add_s2_star,e_s2_gp_add_star,e_s2_tag_add_spawned"
  e_s2_spawn_star:        "setblock RAW_GOLD_BLOCK $s2.star_loc$"
  e_s2_summon_firework:   "command execute in minecraft:overworld run summon firework_rocket $s2.star_loc_xyz$ {LifeTime:10,Motion:[0d,1d,0d],shotAtAngle:1b,FireworksItem:{id:firework_rocket,Count:1,tag:{Fireworks:{Flight:20,Explosions:[{Type:1,Flicker:1b,Colors:[I;14602026]},{Colors:[I;11743532]},{Colors:[I;4312372]}]}}}}"
  e_s2_notif_spawn_star:  "notify &3A star has spawned! io:title"
  e_obj_add_s2_star:      "objective add o_s2_star"
  e_s2_gp_add_star:       "globalpoint sml_s2 1 action:add"
  e_s2_tag_add_spawned:   "tag add s2_spawned"

  # Stop
  e_s2_stop:              "folder e_obj_del_s2_enter,e_obj_del_s2_exit,e_obj_del_s2_delay,e_obj_del_s2_surv,e_obj_del_s2_var"

  # Win
  win_s2:                 "folder e_notif_s2_win,core-sfx.e_got_star,deit_s2,if_firstwin_s2"
  e_notif_s2_win:         "notify &3Chill with the bully\n&2Cleared! io:title"

  # First win
  if_firstwin_s2:         "if !chk_s2_obtained firstwin_s2 else core-main.e_dummy"
  firstwin_s2:            "folder e_broad_s2_first,tag_add_s2_win,e_stop_music,exit_star"
  e_broad_s2_first:       "command broadcast &6%player% &2got a star: [SML] Chill with the bully"
  tag_add_s2_win:         "tag add s2"

  # Cleanup
  deit_s2:                "folder e_obj_del_s2_enter,e_obj_del_s2_exit,e_obj_del_s2_delay,e_obj_del_s2_surv,e_obj_del_s2_star,e_obj_del_s2_var,if_s2_spawned,e_s2_tag_del_spawned"
  e_obj_del_s2_enter:     "objective remove o_s2_enter"
  e_obj_del_s2_exit:      "objective remove o_s2_exit"
  e_obj_del_s2_delay:     "objective remove o_s2_delay_push"
  e_obj_del_s2_surv:      "objective remove o_s2_delay_survive"
  e_obj_del_s2_star:      "objective remove o_s2_star"
  e_obj_del_s2_var:       "objective remove o_s2_variable"

  if_s2_spawned:          "if chk_s2_spawned e_s2_del_spawned else core-main.e_dummy"
  e_s2_del_spawned:       "folder e_s2_gp_sub_star,if_s2_despawn"
  e_s2_gp_sub_star:       "globalpoint sml_s2 1 action:subtract"

  if_s2_despawn:          "if !chk_s2_spawn_count e_s2_delete_star else core-main.e_dummy"
  e_s2_tag_del_spawned:   "tag delete s2_spawned"

  e_s2_delete_star:       "folder e_s2_despawn_star,e_s2_reset_star_count"
  e_s2_despawn_star:      "setblock AIR $s2.star_loc$"
  e_s2_reset_star_count:  "globalpoint sml_s2 0 action:set"


conditions:
  chk_s2_obtained:        "tag s2"
  chk_s2_spawned:         "tag s2_spawned"
  chk_s2_spawn_count:     "globalpoint sml_s2 1"


objectives:
  o_s2_star:              "action right any loc:$s2.star_loc$ events:win_s2"

  o_s2_enter:             "region sml_ice_platform enter events:e_s2_enter"
  o_s2_exit:              "region sml_ice_platform_exit exit events:e_s2_exit"
  o_s2_delay_push:        "delay %randomnumber.whole.$s2.int.fr$~$s2.int.to$% ticks interval:$s2.int.fr$ events:e_s2_fol_push"
  o_s2_delay_survive:     "delay $s2.surv$ seconds interval:5 events:e_s2_success"

  o_s2_variable:          "variable"
